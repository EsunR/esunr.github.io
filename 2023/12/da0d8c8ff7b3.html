<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="Webpack 操练场 ①：第一个 Webpack 应用"><meta name="keywords" content="webpack"><meta name="author" content="EsunR"><meta name="copyright" content="EsunR"><title>Webpack 操练场 ①：第一个 Webpack 应用 | EsunR-Blog</title><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://hm.baidu.com"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?31bd12722efcf47cb7d0d576bf150215";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3RG97DCL3N"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-3RG97DCL3N');</script><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.2.0'
} </script><meta name="generator" content="Hexo 6.2.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA-Webpack-%E5%BA%94%E7%94%A8"><span class="toc-text">第一个 Webpack 应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-webpack"><span class="toc-text">安装 webpack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%87%BA%E5%85%A5%E5%8F%A3"><span class="toc-text">定义出入口</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86-HTML"><span class="toc-text">处理 HTML</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86-CSS"><span class="toc-text">处理 CSS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-text">处理静态资源</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E5%88%AB%E5%90%8D"><span class="toc-text">路径别名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#devServer"><span class="toc-text">devServer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Source-map-%E6%BA%90%E4%BB%A3%E7%A0%81%E6%98%A0%E5%B0%84"><span class="toc-text">Source map 源代码映射</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%92%8C%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E8%BF%9B%E8%A1%8C%E5%8C%BA%E5%88%86"><span class="toc-text">将开发环境和生产环境进行区分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%EF%BC%9Apost-css"><span class="toc-text">进阶：post-css</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%EF%BC%9Ababel"><span class="toc-text">进阶：babel</span></a></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="https://esunr-webapp.cdn.bcebos.com/blog/avatar.jpeg?x-bce-process=image/resize,m_lfit,w_200/format,f_auto" alt="avatar"></div><div class="author-info__name text-center">EsunR</div><div class="author-info__description text-center">EsunR-Blog是由EsunR维护的博客平台，分享在前端开发、Git、Vue.js、Webpack、OAuth、Linux等各个领域的知识和经验。浏览这里的深入文章，了解不同主题的见解，并及时了解行业的最新趋势和技术。</div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/EsunR">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">170</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">151</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">25</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://esunr-webapp.cdn.bcebos.com/blog/background.png?x-bce-process=image/quality,q_80/format,f_auto)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">EsunR-Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><span class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></span></span></div><div id="post-info"><div id="post-title">Webpack 操练场 ①：第一个 Webpack 应用</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2023-12-26</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/">前端工程化</a><span class="post-meta__separator">|</span><i class="fa fa-comment-o post-meta__icon" aria-hidden="true"></i><a href="/2023/12/da0d8c8ff7b3.html#disqus_thread"><span class="disqus-comment-count" data-disqus-identifier="2023/12/da0d8c8ff7b3.html"></span></a><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">4.5k</span><span class="post-meta__separator">|</span><span>Reading time: 16 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="第一个-Webpack-应用"><a href="#第一个-Webpack-应用" class="headerlink" title="第一个 Webpack 应用"></a>第一个 Webpack 应用</h1><p>对应代码：<a target="_blank" rel="noopener" href="https://github.com/EsunR/webpack-playground/tree/main/templates/html">https://github.com/EsunR/webpack-playground/tree/main/templates/html</a></p>
<h2 id="安装-webpack"><a href="#安装-webpack" class="headerlink" title="安装 webpack"></a>安装 webpack</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># npm</span></span><br><span class="line">npm install webpack webpack-cli -D</span><br><span class="line"></span><br><span class="line"><span class="comment"># pnpm（本项目）</span></span><br><span class="line">pnpm install webpack webpack-cli -D</span><br></pre></td></tr></table></figure>

<ul>
<li>webpack：webpack 的核心库，提供了 webpack 的核心打包功能</li>
<li>webpack-cli：webpack 的命令行工具，提供了 webpack 的命令行功能，使得用户可以在命令行中运行 webpack</li>
</ul>
<h2 id="定义出入口"><a href="#定义出入口" class="headerlink" title="定义出入口"></a>定义出入口</h2><p>webpack 只需要配置一个入口和一个出口，就已经可以进行基础的打包了，通过以下两个配置可以定义：</p>
<ul>
<li>entry 代码入口</li>
<li>output 配置编译产出</li>
</ul>
<p>创建 <code>webpack.config.cjs</code> 文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">  <span class="comment">// 入口</span></span><br><span class="line">  <span class="attr">entry</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src/main.js&#x27;</span>),</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="comment">// 输出路径</span></span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./dist&#x27;</span>),</span><br><span class="line">    <span class="comment">// 每次打包前清空 dist 目录</span></span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>output.path 必须是绝对路径，因此会用到下面的方法来获取绝对路径：</p>
<ul>
<li><code>path.resolve()</code> 方法会把一个路径或路径片段的序列解析为一个绝对路径</li>
<li><code>__dirname</code> 是 node.js 中的一个全局变量（仅 CommonJS 环境），它指向当前执行脚本所在的目录</li>
</ul>
<p>因此，<code>path.resolve(__dirname, &quot;./dist&quot;)</code> 代表的就是当前目录下的 dist 目录。</p>
<blockquote>
<p>什么是相对路径：相对路径是相对于当前工作目录或者当前文件的路径来表示目标文件的位置。它以当前位置为基准，通过使用特定的路径规则来定位文件。相对路径往往使用相对于当前目录的文件路径，或者相对于当前文件所在目录的路径。例如，在当前目录下的文件A中使用相对路径”../fileB”来引用上级目录下的文件B，即表示A所在目录的上级目录。</p>
</blockquote>
<blockquote>
<p>什么是绝对路径：绝对路径是从文件系统的根目录开始的完整路径名称，它可以准确地定位文件或目录的位置。绝对路径描述的是文件或目录的完整路径，不论当前工作目录是什么，它总是可以指向相同的位置。例如，在UNIX系统上，绝对路径可能是”/usr/local/bin/fileA”，在Windows系统上可能是”C:\Program Files\fileA”。</p>
</blockquote>
<p>在终端输入 webpack 指令进行构建：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># npm</span></span><br><span class="line">npx webpack --config webpack.config.cjs</span><br><span class="line"></span><br><span class="line"><span class="comment"># pnpm（本项目）</span></span><br><span class="line">pnpm <span class="built_in">exec</span> webpack --config webpack.config.cjs</span><br></pre></td></tr></table></figure>

<p>为了方便使用，我们将执行 webpack 构建的命令行指令写入到 package.json 的 script 中：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --config webpack.config.cjs&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>这样就可以通过 <code>npm run build</code> (npm 管理) 或 <code>pnpm build</code> (pnpm 管理) 来执行 webpack 构建了。</p>
<h2 id="处理-HTML"><a href="#处理-HTML" class="headerlink" title="处理 HTML"></a>处理 HTML</h2><p>使用 <a target="_blank" rel="noopener" href="https://github.com/jantimon/html-webpack-plugin">html-webpack-plugin</a> 插件：可以将 JS 引入到 HTML 中</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">HtmlWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// webpack 其他配置</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">HtmlWebpackPlugin</span>(&#123;</span><br><span class="line">      <span class="comment">// 在这里可以填写插件配置，如模板位置、注入 css、js 的方式等</span></span><br><span class="line">      <span class="comment">// 文档：https://github.com/jantimon/html-webpack-plugin#options</span></span><br><span class="line">      <span class="attr">template</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./public/index.html&#x27;</span>),</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="处理-CSS"><a href="#处理-CSS" class="headerlink" title="处理 CSS"></a>处理 CSS</h2><p>loader: webpack 会将所有的资源都作为模块引入，但是引入相对应的资源必须有对应的 loader 才可以。</p>
<p>处理 css 必须使用以下两个 loader：</p>
<ul>
<li>css-loader：只负责编译 css 代码，让 import、require、@import、url 语法生效，成功引入 css 模块，但不负责让 css 生效</li>
<li>style-loader：将 css-loader 的产出，注入到 html 里</li>
</ul>
<p>添加样式处理的 Loader:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// webpack 其他配置</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      <span class="comment">// ... 其他 loader ...</span></span><br><span class="line">      <span class="comment">// 处理 css 文件</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="comment">// loader 的执行顺序是从后往前的，因此先执行 css-loader，再执行 style-loader</span></span><br><span class="line">          <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>style-loader</code> 会使用 js 将 css 代码注入到 html 里，如果想要将 css 代码单独抽离出来，可以使用 <code>mini-css-extract-plugin</code> 插件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">MiniCssExtractPlugin</span> = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// webpack 其他配置</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      <span class="comment">// ... 其他 loader ...</span></span><br><span class="line">      <span class="comment">// 处理 css 文件</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="comment">// &#x27;style-loader&#x27;,</span></span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">          <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// 注意：mini-css-extract-plugin 还包含一个插件需要引入</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="处理静态资源"><a href="#处理静态资源" class="headerlink" title="处理静态资源"></a>处理静态资源</h2><p>webpack4 需要使用 file-loader 处理静态资源</p>
<p>但是 webpack5 内置了静态资源 loader，通过指定模块类型为 <code>asset/resource</code> 就可以让 webpack 自动使用静态资源 loader：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">module</span>: &#123;</span><br><span class="line">  <span class="attr">rules</span>: [</span><br><span class="line">    <span class="comment">// ... 其他 loader ...</span></span><br><span class="line">    <span class="comment">// 处理静态资源</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">test</span>: <span class="regexp">/\.(png|svg|jpg|jpeg|gif|mp3|mp4)$/i</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;asset/resource&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="路径别名"><a href="#路径别名" class="headerlink" title="路径别名"></a>路径别名</h2><p>通过 <code>resolve.alias</code> 配置路径别名，让 webpack 识别：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// webpack 其他配置</span></span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&#x27;@&#x27;</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&#x27;./src&#x27;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>但同时，还需要让 vscode 认识配置的路径别名，通过创建一个 <code>jsconfig.json</code> 文件来声明路径别名：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;@/*&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;./src/*&quot;</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="devServer"><a href="#devServer" class="headerlink" title="devServer"></a>devServer</h2><p><a target="_blank" rel="noopener" href="https://webpack.docschina.org/configuration/dev-server/">https://webpack.docschina.org/configuration/dev-server/</a></p>
<p>安装完 <code>webpack-dev-server</code> 后，添加 dev 指令到 package.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;dev&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack serve --config webpack.config.cjs&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;build&quot;</span><span class="punctuation">:</span> <span class="string">&quot;webpack --config webpack.config.cjs&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>在终端运行 <code>pnpm dev</code> 就可以启动 dev server 了。</p>
<h2 id="Source-map-源代码映射"><a href="#Source-map-源代码映射" class="headerlink" title="Source map 源代码映射"></a>Source map 源代码映射</h2><p>如果我们的代码中存在一行报错，那么在没有配置 source map 的情况下，浏览器控制台显示的是编译后的代码，这样我们很难定位到错误的位置。</p>
<p>如下，我们根据控制台报错信息，定位到的代码是经过编译的，并且不会告诉我们具体文件的第几行出错了：</p>
<p><img src="https://esunr-image-bed.oss-cn-beijing.aliyuncs.com/picgo/202312061421050.png" alt=""></p>
<p><img src="https://esunr-image-bed.oss-cn-beijing.aliyuncs.com/picgo/202312061421633.png" alt=""></p>
<p>因此 webpack 提供了一种生成源代码映射文件的功能，通过这个文件，我们可以将编译后的代码映射到源代码，这样就可以在浏览器控制台中看到源代码了。</p>
<p>如下，开启了 source map 后，根据控制台的报错信息，定位到的文件是编译前的代码，并且能够告诉我们具体文件的第几行出错了：</p>
<p><img src="https://esunr-image-bed.oss-cn-beijing.aliyuncs.com/picgo/202312061423011.png" alt=""></p>
<p><img src="https://esunr-image-bed.oss-cn-beijing.aliyuncs.com/picgo/202312061424398.png" alt=""></p>
<p>通过 <code>devtool</code> 选项可以开启源代码映射：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// webpack 其他配置</span></span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&#x27;source-map&#x27;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>devtool</code> 的值除了 <code>source-map</code> 之外，还支持以下几个常用选项：</p>
<ul>
<li>eval: 每个 module 会封装到 eval 里包裹起来执行，并且会在末尾追加注释 //@ sourceURL.</li>
<li>source-map: 生成一个 SourceMap 文件.</li>
<li>hidden-source-map: 和 source-map 一样，但不会在 bundle 末尾追加注释.</li>
<li>inline-source-map: 生成一个 DataUrl 形式的 SourceMap 文件.</li>
<li>eval-source-map: 每个 module 会通过 eval() 来执行，并且生成一个 DataUrl 形式的 SourceMap .</li>
<li>cheap-source-map： 生成一个没有列信息（column-mappings）的 SourceMaps 文件，不包含 loader 的 sourcemap（譬如 babel 的 sourcemap）</li>
<li>cheap-module-source-map： 生成一个没有列信息（column-mappings）的 SourceMaps 文件，同时 loader 的 sourcemap 也被简化为只包含对应行的。</li>
</ul>
<p>不通的选项构建速度是不同的，为了达到一个比较好的构建效果，我们通常建议在开发模式下使用 <code>eval-cheap-module-source-map</code> 来提升构建速度。在生产环境下使用 <code>source-map</code> 来将 source map 文件单独抽离出来，不要让 source map 的代码被打包到源代码中。</p>
<h2 id="将开发环境和生产环境进行区分"><a href="#将开发环境和生产环境进行区分" class="headerlink" title="将开发环境和生产环境进行区分"></a>将开发环境和生产环境进行区分</h2><p>在编写 webpack 配置时，开发环境和生产环境可能会需要不通的配置。比如在上一节中，我们讲了要在开发环境下使用 <code>eval-cheap-module-source-map</code> 而在生产环境下使用 <code>source-map</code>。通常我们会使用构建时的系统环境变量来区分生产与开发环境。</p>
<p>我们将 package.json 中的构建脚本进行修改：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line"><span class="deletion">-   &quot;dev&quot;: &quot;webpack serve --config webpack.config.cjs&quot;,</span></span><br><span class="line"><span class="addition">+   &quot;dev&quot;: &quot;export NODE_ENV=development &amp;&amp; webpack serve --config webpack.config.cjs&quot;,</span></span><br><span class="line"><span class="deletion">-   &quot;build&quot;: &quot;webpack --config webpack.config.cjs&quot;</span></span><br><span class="line"><span class="addition">+   &quot;build&quot;: &quot;export NODE_ENV=production &amp;&amp; webpack --config webpack.config.cjs&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>export</code> 指令是 Linux 系统中的一个指令，它可以设置环境变量。比如我们在终端中输入 <code>export TEST_ENV=1</code> 这样就设置了一个系统环境变量，我们可以通过 <code>echo $TEST_ENV</code> 来输出这个环境变量（但是这个环境变量只在当前终端中生效，新建了一个终端后这个环境变量就不存在了）。</p>
<p>这里我们使用 <code>export NODE_ENV=development</code> 与 <code>export NODE_ENV=production</code> 来为系统设置了一个 <code>NODE_ENV</code> 的环境变量。这意味着，我们在执行 <code>pnpm dev</code> 指令时，系统 <code>NODE_ENV</code> 环境变量为 <code>development</code>，在执行 <code>pnpm build</code> 指令时，系统 <code>NODE_ENV</code> 环境变量为 <code>production</code>。</p>
<p>但是这里存在一个问题，不同的操作环境可能会有不通的指令，比如在 Linux 系统中使用 <code>export</code> 指令，而在 Windows 系统中使用 <code>set</code> 指令。因此我们需要一个跨平台的指令来设置环境变量，这个指令就是 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/cross-env">cross-env</a>。</p>
<p>首先安装 cross-env</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install cross-env -D</span><br></pre></td></tr></table></figure>

<p>然后将 <code>export</code> 指令替换为 <code>cross-env</code> 指令：</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;scripts&quot;: &#123;</span><br><span class="line"><span class="deletion">-   &quot;dev&quot;: &quot;export NODE_ENV=development &amp;&amp; webpack serve --config webpack.config.cjs&quot;,</span></span><br><span class="line"><span class="addition">+   &quot;dev&quot;: &quot;cross-env NODE_ENV=development webpack serve --config webpack.config.cjs&quot;,</span></span><br><span class="line"><span class="deletion">-   &quot;build&quot;: &quot;export NODE_ENV=production &amp;&amp; webpack --config webpack.config.cjs&quot;</span></span><br><span class="line"><span class="addition">+   &quot;build&quot;: &quot;cross-env NODE_ENV=production webpack --config webpack.config.cjs&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设定完环境变量后，我们在 webpack 配置文件中使用 <code>process.env.NODE_ENV</code> 来获取当前的环境变量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isDev = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>这样一来，当 <code>isDev</code> 为 <code>true</code> 时，就代表当前执行的指令是 <code>pnpm dev</code> 也就是开发环境；当 <code>isDev</code> 为 <code>false</code> 时，就代表当前执行的指令是 <code>pnpm build</code> 也就是生产环境。通过这个变量我们就可以为 webpack 配置进行一些差异化的配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isDev = process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">mode</span>: isDev ? <span class="string">&#x27;development&#x27;</span> : <span class="string">&#x27;production&#x27;</span>, <span class="comment">// 根据环境变量设置 mode</span></span><br><span class="line">  <span class="attr">devtool</span>: isDev ? <span class="string">&#x27;eval-cheap-module-source-map&#x27;</span> : <span class="string">&#x27;source-map&#x27;</span>, <span class="comment">// 根据环境变量设置 devtool</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="comment">// 在开发环境下使用 style-loader 以提升构建速度，生产环境下使用 mini-css-extract-plugin 插件抽离 css</span></span><br><span class="line">          isDev ? <span class="string">&#x27;style-loader&#x27;</span> : <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">          <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">          <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// ... ...</span></span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// 其他 webpack 配置</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="进阶：post-css"><a href="#进阶：post-css" class="headerlink" title="进阶：post-css"></a>进阶：post-css</h2><p><a target="_blank" rel="noopener" href="https://postcss.org/">PostCSS</a> 是一个用 JavaScript 编写的工具，它可以对 CSS 进行处理、转换和优化，如：</p>
<ul>
<li>使用 autoprefixer 为写好的 css 属性自动添加浏览器前缀</li>
<li>为 css 添加变量、嵌套、函数等特性</li>
<li>使用一些 css 的新特性，同时为旧浏览器提供降级方案</li>
</ul>
<p>首先，需要安装 postcss 提供 postcss 的核心支持，为了让 webpack 能够成功调用 postcss 还需要安装 <a target="_blank" rel="noopener" href="https://github.com/webpack-contrib/postcss-loader#getting-started">postcss-loader</a>：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install postcss postcss-loader -D</span><br></pre></td></tr></table></figure>

<p>在 webpack 中添加对应的 loader:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// webpack 其他配置</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      <span class="comment">// ... 其他 loader ...</span></span><br><span class="line">      <span class="comment">// 处理 css 文件</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/i</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          <span class="title class_">MiniCssExtractPlugin</span>.<span class="property">loader</span>,</span><br><span class="line">          <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">          <span class="comment">// 添加 post-css loader</span></span><br><span class="line">          <span class="comment">// 注意：postcss 只能处理 css 代码，因此如果添加使用 saas、less 等 css 预处理器，postcss-loader 要放在对应的预处理器 loader 的前面</span></span><br><span class="line">          <span class="string">&#x27;postcss-loader&#x27;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>为了使 postcss 生效，还需要在项目的根目录下创建一个 <code>postcss.config.js</code> 文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="comment">// 添加你想使用的插件</span></span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><code>postcss-loader</code> 会自动读取这个文件，但是目前我们尚未配置任何插件，postcss 并不会正产工作。一般情况下，我们只需要引入 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/postcss-preset-env">postcss-preset-env</a> 即可，这个插件可以将现代 CSS 转换成大多数浏览器都能理解的内容，同时也可以根据目标浏览器或运行时环境添加所需的语法垫片。</p>
<p>首先，我们要安装这个插件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install postcss-preset-env -D</span><br></pre></td></tr></table></figure>

<p>然后向 <code>postcss.config.js</code> 中添加这个插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> postcssPresetEnv = <span class="built_in">require</span>(<span class="string">&#x27;postcss-preset-env&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="title function_">postcssPresetEnv</span>()],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>默认的，<code>postcss-preset-env</code> 提供了缩进语法的特性，我们可以编写带缩进的 css 代码来判断 postcss 是否生效：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.hello</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line"></span><br><span class="line">  <span class="selector-tag">a</span> &#123;</span><br><span class="line">    <span class="attribute">color</span>: pink;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行 webpack 构建指令后，查看编译后的代码：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.hello</span> &#123;</span><br><span class="line">  <span class="attribute">background-color</span>: pink;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.hello</span> <span class="selector-tag">a</span> &#123;</span><br><span class="line">  <span class="attribute">color</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认情况下，postcss-preset-env 会自动按照 browserslist 的默认兼容策略来编译 css，按照默认策略可以兼容 80% 以上的浏览器。</p>
<p>browserslist 是一个用于专门声明当前项目的目标浏览器的配置文件，如果我们要调整 postcss-preset-env 的默认兼容策略，就可以在项目根目录创建一个 <code>.browserslistrc</code> 的文件，并编写对应的配置，如下是一个提供更广泛兼容的配置，它兼容了全世界市场占用率大于 0.5% 的浏览器，并兼容所有主流浏览器（包括已经停止更新的）的最后两个版本：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; 0.5%, last 2 versions</span><br></pre></td></tr></table></figure>

<p>使用了这个配置后你就会发现编译出的代码变得更大了，很多属性都被添加了 css 属性前缀，因为它需要兼容更多的浏览器。</p>
<blockquote>
<p>你可以在 <a target="_blank" rel="noopener" href="https://browsersl.ist/#q=defaults">browsersl.ist</a> 网站上查看 browserslist 的配置规则</p>
</blockquote>
<h2 id="进阶：babel"><a href="#进阶：babel" class="headerlink" title="进阶：babel"></a>进阶：babel</h2><p><a target="_blank" rel="noopener" href="https://babeljs.io/">Babel</a> 与 PostCSS 类似，都是一种语言的编译器，PostCSS 负责处理 CSS 而 Babel 负责处理 JavaScript。通过使用 Babel，能够将高级版本的 JavaScript 代码转换为向后兼容的版本，以便能够在老版本的浏览器或环境中运行。</p>
<p>首先，我们要安装 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@babel/core">@babel/core</a> 来提供 babel 的核心支持，同时还需要安装 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/babel-loader">babel-loader</a> 来让 webpack 能够调用 babel：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install @babel/core babel-loader -D</span><br></pre></td></tr></table></figure>

<p>然后在 webpack 中添加对应的 loader:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// webpack 其他配置</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      <span class="comment">// ... 其他 loader ...</span></span><br><span class="line">      <span class="comment">// 处理 js 文件</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(?:js|mjs|cjs)$/</span>, <span class="comment">// 匹配 js、mjs、cjs 后缀的文件</span></span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>, <span class="comment">// 从 node_modules 引入的 js 代码不需要 babel 参与编译（因为大多数包已经被编译好了）</span></span><br><span class="line">        <span class="attr">use</span>: &#123;</span><br><span class="line">          <span class="attr">loader</span>: [<span class="string">&#x27;babel-loader&#x27;</span>],</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>为了使 babel 生效，与 PostCSS 类似的，我们需要一个 babel 的配置文件，在项目的根目录下创建一个 <code>babel.config.js</code> 文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    <span class="comment">// 添加你想使用的预设</span></span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>可以发现，Babel 的配置文件与 PostCSS 的配置文件是类似的，因为它们的工作原理都是本身提供一个核心库的支持，而具体的工作则需要对应的插件来完成，因此我们需要安装对应的插件。</p>
<p>在没有什么其他需求的情况下，我们可以安装 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@babel/preset-env">@babel/preset-env</a> 插件来提供一个较为全面的预设配置，改配置可以将现代 JavaScript 代码转换为向后兼容的版本，以便能够在老版本的浏览器或环境中运行。</p>
<p>首先我们安装该插件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install @babel/preset-env -D</span><br></pre></td></tr></table></figure>

<p>然后在 <code>babel.config.js</code> 中添加该插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// preset config</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>还记得在上一步我们编写的 browserslist 配置吗？<code>@babel/preset-env</code> 同样会根据它来生成对应目标的兼容代码。</p>
<p>当我们执行 webpack 编译指令后，可以发现编译出的代码中，箭头函数、const、let 等新特性都被转换成了 ES5 的代码。以 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Optional_chaining">可选链运算符</a> 为例子，原代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> o = &#123; <span class="attr">a</span>: <span class="number">123</span> &#125;;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o?.<span class="property">a</span> ?? <span class="string">&#x27;nothing&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>为了兼容大部分的浏览器，babel 将可选链操作符进行转换为三元运算符，得出编译后的代码为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(</span><br><span class="line">  <span class="literal">null</span> !== (n = <span class="literal">null</span> == a ? <span class="keyword">void</span> <span class="number">0</span> : a.<span class="property">a</span>) &amp;&amp; <span class="keyword">void</span> <span class="number">0</span> !== n ? n : <span class="string">&#x27;nothing&#x27;</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>很多人 babel 配置到这里就觉得万事大吉了，但实际上编译出来的代码并没有按照预想的那样去兼容到低版本浏览器。因为 babel 只会转换新的 JavaScript 语法，但是不会转换新的 API，也就是说，Babel 可以将你的箭头函数、const、let 等新语法转换成 ES5 的代码，但是它不会将 Promise、Array.from、Object.assign 等新的 API、对象转化为 ES5 环境可用的代码。</p>
<p>因此我们如果想要让 ES5 环境的浏览器支持这些新的 API，就需要去实现它们，这种实现被称为 polyfill（语法垫片）。@babel/preset-env 支持引入需要的 polyfill，但是 preset-env 并没有这些 polyfill 的实现，因此我们需要安装 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/core-js">core-js</a>，core-js 是一个提供了大量 polyfill 的库，它的 polyfill 覆盖了 ES5、ES6、ES7、ES8、ES9、ES10、ES11、ES12 等所有的 ECMAScript 标准。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install core-js</span><br></pre></td></tr></table></figure>

<p>然后，需要在 <code>babel.config.js</code> 中添加 <code>core-js</code> 的配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">corejs</span>: <span class="number">3</span>, <span class="comment">// 指定 core-js 版本</span></span><br><span class="line">        <span class="attr">useBuiltIns</span>: <span class="string">&#x27;usage&#x27;</span>, <span class="comment">// 按需引入 polyfill</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>运行构建指令后，我们会发现构建产出大了很多，这是因为 babel 从 core-js 引入了当前项目所需要的 polyfill。</p>
<blockquote>
<p>在决定是否使用 core-js 时，一定要考虑到你的项目是否真的需要这些 polyfill，比如项目如果使用 Vue3，那么就不需要引入大量为了兼容 ES5 环境的 polyfill，因为 Vue3 本身就是基于 ES6 环境开发的。</p>
</blockquote>
<p>但是此时还存在两个问题需要解决：</p>
<ol>
<li>babel 会将 core-js 的 polyfill 还有一些 helper 函数打包到每个文件中，这样会导致每个文件都包含了重复的代码，从而导致打包后的文件体积变大。</li>
<li>babel 引入的 polyfill 函数会污染全局环境，这样会导致全局环境中存在大量的 polyfill 函数，这些函数可能会与其他库冲突。</li>
</ol>
<p>为了解决这两个问题，我们需要安装 <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@babel/plugin-transform-runtime">@babel/plugin-transform-runtime</a> 插件（需要 @babel/runtime 支持），它会将 babel 重复引用的函数转换为 runtime 函数，从而解决上面的问题，并减少打包后的文件体积。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pnpm install @babel/plugin-transform-runtime @babel/runtime -D</span><br></pre></td></tr></table></figure>

<p>然后在 <code>babel.config.js</code> 中添加该插件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">presets</span>: [</span><br><span class="line">    [</span><br><span class="line">      <span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">corejs</span>: <span class="number">3</span>, <span class="comment">// 指定 core-js 版本</span></span><br><span class="line">        <span class="attr">useBuiltIns</span>: <span class="string">&#x27;usage&#x27;</span>, <span class="comment">// 按需引入 polyfill</span></span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="string">&#x27;@babel/plugin-transform-runtime&#x27;</span>],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/webpack/">webpack</a></div><div class="addthis_inline_share_toolbox pull-right"></div><script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-62c7f2684e36ba34" async></script><nav id="pagination"><div class="prev-post pull-left"><a href="/2023/12/cf01b787d4b4.html"><i class="fa fa-chevron-left">  </i><span>Webpack 操练场 ②：使用 Webpack 构建 TypeScript 开发环境</span></a></div><div class="next-post pull-right"><a href="/2023/12/88456067f15c.html"><span>在 Webpack 中同时使用 ts-loader 和 babel-loader</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="disqus_thread"></div><script>var unused = null;
var disqus_config = function () {
  this.page.url = 'https://blog.esunr.site/2023/12/da0d8c8ff7b3.html';
  this.page.identifier = '2023/12/da0d8c8ff7b3.html';
  this.page.title = 'Webpack 操练场 ①：第一个 Webpack 应用';
}
var d = document, s = d.createElement('script');
s.src = "https://" + 'esunr-blog' +".disqus.com/embed.js";
s.setAttribute('data-timestamp', '' + +new Date());
(d.head || d.body).appendChild(s);</script><script id="dsq-count-scr" src="https://esunr-blog.disqus.com/count.js" async></script></div></div><footer class="footer-bg" style="background-image: url(https://esunr-webapp.cdn.bcebos.com/blog/background.png?x-bce-process=image/quality,q_80/format,f_auto)"><div class="layout" id="footer"><div class="copyright">&copy;2017 - 2025 By EsunR</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file-o"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/local-search.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts"></div></div></div><hr><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>